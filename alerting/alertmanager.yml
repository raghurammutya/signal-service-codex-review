{
  "global": {
    "smtp_smarthost": "${SMTP_HOST}:587",
    "smtp_from": "alerts@signal-service.com"
  },
  "route": {
    "group_by": [
      "alertname"
    ],
    "group_wait": "10s",
    "group_interval": "10s",
    "repeat_interval": "1h",
    "receiver": "web.hook",
    "routes": [
      {
        "match": {
          "severity": "critical"
        },
        "receiver": "critical-alerts",
        "group_wait": "5s",
        "repeat_interval": "5m"
      },
      {
        "match": {
          "severity": "warning"
        },
        "receiver": "warning-alerts",
        "group_wait": "30s",
        "repeat_interval": "30m"
      }
    ]
  },
  "receivers": [
    {
      "name": "web.hook",
      "webhook_configs": [
        {
          "url": "http://webhook:5000/alerts"
        }
      ]
    },
    {
      "name": "critical-alerts",
      "pagerduty_configs": [
        {
          "service_key": "${PAGERDUTY_SERVICE_KEY}",
          "description": "Signal Service Critical Alert: {{ range .Alerts }}{{ .Annotations.summary }}{{ end }}",
          "severity": "critical"
        }
      ],
      "slack_configs": [
        {
          "api_url": "${SLACK_WEBHOOK_URL}",
          "channel": "#signal-service-alerts",
          "title": "\ud83d\udea8 CRITICAL: Signal Service Alert",
          "text": "{{ range .Alerts }}{{ .Annotations.summary }}\\n{{ .Annotations.description }}{{ end }}",
          "color": "danger"
        }
      ]
    },
    {
      "name": "warning-alerts",
      "slack_configs": [
        {
          "api_url": "${SLACK_WEBHOOK_URL}",
          "channel": "#signal-service-monitoring",
          "title": "\u26a0\ufe0f WARNING: Signal Service Alert",
          "text": "{{ range .Alerts }}{{ .Annotations.summary }}\\n{{ .Annotations.description }}{{ end }}",
          "color": "warning"
        }
      ],
      "email_configs": [
        {
          "to": "${ON_CALL_EMAIL}",
          "subject": "Signal Service Warning Alert",
          "body": "{{ range .Alerts }}{{ .Annotations.summary }}\\n{{ .Annotations.description }}{{ end }}"
        }
      ]
    }
  ]
}