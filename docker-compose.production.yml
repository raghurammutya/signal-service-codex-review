services:
  signal-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: signal-service-prod
    environment:
      # MINIMAL ENVIRONMENT VARIABLES - All other config from config_service
      - CONFIG_SERVICE_URL=http://172.18.0.16:8100
      - CONFIG_SERVICE_API_KEY=${CONFIG_SERVICE_API_KEY:-dev-config-api-key-123}
      - INTERNAL_API_KEY=${INTERNAL_API_KEY:-signal-internal-key-123}
      - SERVICE_NAME=signal_service
      - ENVIRONMENT=production
      
      # Production database and redis connections
      - DATABASE_URL=postgresql+asyncpg://stocksblitz:stocksblitz123@stocksblitz-postgres:5432/stocksblitz
      - REDIS_URL=redis://signal-service-test-redis:6379/0
      
      # Container-specific overrides (not in config_service)
      - PORT=${SIGNAL_SERVICE_PORT:-8003}
      - WORKER_ID=${WORKER_ID:-signal-worker-1}
      
    ports:
      - "${SIGNAL_SERVICE_PORT:-8003}:${SIGNAL_SERVICE_PORT:-8003}"
    networks:
      - stocksblitz-prod
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${SIGNAL_SERVICE_PORT:-8003}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    deploy:
      resources:
        limits:
          memory: 2G
          cpus: '1.0'
        reservations:
          memory: 512M
          cpus: '0.5'

networks:
  stocksblitz-prod:
    external: true